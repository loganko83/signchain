import{j as e}from"./ui-vendor-DtKnxXw5.js";import{b as M,u as W}from"./api-D30H7COj.js";import{u as _,C as G,U as J}from"./auth-mRq7nU_R.js";import{r}from"./react-vendor-Dzt9N-8P.js";import{D as Y,a as Z,b as ee,c as se,S as P,f as te}from"./format-BXpLAA_X.js";import{c as ae,f as re,j,I as B,B as i,k as le,A as ne,h as ie,X as ce,i as de,q as R,u as me,C as g,a as p,F as H,S as oe}from"./index-BDx6bSRW.js";import{S as xe,T as he,P as ue}from"./switch-LpYoxIx7.js";import{P as je,a as ge,b as pe}from"./popover-DpVQG62C.js";import{S as O,a as A,b as K,c as U,d as n}from"./select-DjMsFK5h.js";import{U as fe}from"./users-NR0dtYHH.js";import{C as v}from"./clock-BGaxYKCJ.js";import{C as Ne}from"./calendar-DtGYJmaP.js";import{B as D}from"./badge-B1fBHK3E.js";import{B as ye,g as ve,a as we}from"./blockchain-hash-utils-JjUtqpJX.js";import{T as L}from"./trending-up-CTmQh0x4.js";import{C as V}from"./circle-check-big-BxzUcnFn.js";import"./schema-BlUgtGVC.js";import"./chevron-left-ehtWAuAn.js";import"./chevron-right-BQhjzqxP.js";import"./utils-B2rm_Apj.js";import"./index-DPahxWVS.js";import"./index-DmtbdpjK.js";import"./check-B-y8kd2B.js";import"./copy-abr6s6pk.js";import"./external-link-CCe0NQHs.js";import"./circle-alert-CRkskc5c.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]],Se=ae("layout-template",be);function ke({document:a,open:w,onOpenChange:o}){const{user:d}=_(),[u,f]=r.useState(""),[b,N]=r.useState(""),[S,x]=r.useState(""),[c,h]=r.useState(void 0),[y,k]=r.useState(!1),[C,s]=r.useState(1),[l,T]=r.useState("none"),[qe,$]=r.useState(!1),[Fe,z]=r.useState("");r.useState(!1);const{toast:q}=re();M({queryKey:["/api/workflow-templates"],queryFn:async()=>{const t=await fetch(`/api/workflow-templates?userId=${(d==null?void 0:d.id)||""}`);if(!t.ok)throw new Error("템플릿을 가져올 수 없습니다");return t.json()}});const F=W({mutationFn:async t=>de("/api/signature-requests","POST",t),onSuccess:()=>{R.invalidateQueries({queryKey:["/api/signature-requests"]}),R.invalidateQueries({queryKey:["/api/documents"]}),q({title:"서명 요청 전송 완료",description:"서명 요청이 성공적으로 전송되었습니다."}),o(!1),E()},onError:t=>{q({title:"서명 요청 실패",description:t.message||"서명 요청 중 오류가 발생했습니다.",variant:"destructive"})}}),E=()=>{f(""),N(""),x(""),h(void 0),k(!1),s(1),T("none"),$(!1),z("")},Q=async t=>{if(t.preventDefault(),!u.trim()){q({title:"필수 입력",description:"서명자 이메일을 입력해주세요.",variant:"destructive"});return}let m=c;if(l!=="none"&&l!=="custom"){const I=l==="3days"?3:l==="1week"?7:l==="2weeks"?14:30;m=new Date,m.setDate(m.getDate()+I)}try{await F.mutateAsync({documentId:a.id,requesterId:(d==null?void 0:d.id)||0,signerEmail:u.trim(),signerName:b.trim()||void 0,message:S.trim()||void 0,deadline:m,isSequential:y,signatureOrder:C})}catch(I){console.error("Signature request error:",I)}};return e.jsx(Y,{open:w,onOpenChange:o,children:e.jsxs(Z,{className:"max-w-md",children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"서명 요청 보내기"]})}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"문서"}),e.jsx("div",{className:"font-semibold",children:a.title})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"signerEmail",children:"서명자 이메일 *"}),e.jsx(B,{id:"signerEmail",type:"email",value:u,onChange:t=>f(t.target.value),placeholder:"signer@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"signerName",children:"서명자 이름 (선택사항)"}),e.jsx(B,{id:"signerName",value:b,onChange:t=>N(t.target.value),placeholder:"홍길동"})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm font-medium",children:"순차 서명"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"서명자들이 순서대로 서명하도록 설정"})]}),e.jsx(xe,{checked:y,onCheckedChange:k})]}),y&&e.jsxs("div",{children:[e.jsx(j,{htmlFor:"signatureOrder",children:"서명 순서"}),e.jsxs(O,{value:C.toString(),onValueChange:t=>s(parseInt(t)),children:[e.jsxs(A,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),e.jsx(K,{})]}),e.jsxs(U,{children:[e.jsx(n,{value:"1",children:"1번째 서명자"}),e.jsx(n,{value:"2",children:"2번째 서명자"}),e.jsx(n,{value:"3",children:"3번째 서명자"}),e.jsx(n,{value:"4",children:"4번째 서명자"}),e.jsx(n,{value:"5",children:"5번째 서명자"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{children:"서명 마감일"}),e.jsxs(O,{value:l,onValueChange:T,children:[e.jsxs(A,{children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"마감일 설정"})]}),e.jsxs(U,{children:[e.jsx(n,{value:"none",children:"마감일 없음"}),e.jsx(n,{value:"3days",children:"3일 후"}),e.jsx(n,{value:"1week",children:"1주일 후"}),e.jsx(n,{value:"2weeks",children:"2주일 후"}),e.jsx(n,{value:"1month",children:"1개월 후"}),e.jsx(n,{value:"custom",children:"직접 설정"})]})]}),l==="custom"&&e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:le("w-full justify-start text-left font-normal mt-2",!c&&"text-muted-foreground"),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),c?te(c,"PPP"):"마감일 선택"]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(G,{mode:"single",selected:c,onSelect:h,disabled:t=>t<new Date,initialFocus:!0})})]}),l!=="none"&&l!=="custom"&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["마감일: ",(()=>{const t=l==="3days"?3:l==="1week"?7:l==="2weeks"?14:30,m=new Date;return m.setDate(m.getDate()+t),m.toLocaleDateString("ko-KR")})()]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"message",children:"메시지 (선택사항)"}),e.jsx(he,{id:"message",value:S,onChange:t=>x(t.target.value),placeholder:"서명 요청에 대한 추가 메시지를 입력하세요...",rows:3})]}),e.jsx(ne,{children:e.jsx(ie,{className:"text-sm",children:"서명 링크가 이메일로 전송되며, 블록체인에 영구 기록됩니다."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{type:"submit",className:"flex-1",disabled:F.isPending,children:F.isPending?"전송 중...":e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"서명 요청 전송"]})}),e.jsx(i,{type:"button",variant:"outline",onClick:()=>{o(!1),E()},children:e.jsx(ce,{className:"h-4 w-4"})})]})]})]})})}function Ce(){const a=["0.001","0.002","0.001","0.003"];return a[Math.floor(Math.random()*a.length)]+" XPH"}function De(){return(1234567+Math.floor(Math.random()*100)).toLocaleString()}function X(){return{isConnected:!0,blockHeight:De(),gasFee:Ce(),network:"Xphere Mainnet"}}function ts(){const{user:a}=me(),[w,o]=r.useState(!1),[d,u]=r.useState(!1),[f,b]=r.useState(null),[N,S]=r.useState(X());r.useEffect(()=>{const s=setInterval(()=>{S(X())},3e4);return()=>clearInterval(s)},[]);const{data:x=[]}=M({queryKey:["/api/documents"],queryFn:async()=>{const s=await fetch(`/api/documents?userId=${a==null?void 0:a.id}`);if(!s.ok)throw new Error("문서를 가져올 수 없습니다");return s.json()},enabled:!!a}),{data:c=[]}=M({queryKey:["/api/signature-requests"],queryFn:async()=>{const s=await fetch(`/api/signature-requests?userId=${a==null?void 0:a.id}`);if(!s.ok)throw new Error("서명 요청을 가져올 수 없습니다");return s.json()},enabled:!!a}),h={totalDocuments:x.length,completedSignatures:x.filter(s=>s.status==="서명 완료").length,pendingSignatures:c.filter(s=>s.status==="대기").length,blockchainVerified:"100%"},y=s=>{b(s),u(!0)},k=s=>s.includes("pdf")?"fas fa-file-pdf text-red-500":s.includes("word")?"fas fa-file-word text-blue-500":s.includes("excel")?"fas fa-file-excel text-green-500":s.includes("image")?"fas fa-file-image text-purple-500":"fas fa-file-alt text-gray-500",C=s=>{switch(s){case"서명 완료":return e.jsxs(D,{className:"bg-green-100 text-green-800",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"완료"]});case"서명 대기":return e.jsxs(D,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"대기"]});case"업로드됨":return e.jsx(D,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"업로드됨"});default:return e.jsx(D,{variant:"outline",children:s})}};return e.jsxs("div",{className:"bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"대시보드"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"블록체인 기반 전자서명으로 안전하게 문서를 관리하세요"})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:[e.jsxs(i,{onClick:()=>o(!0),className:"bg-primary hover:bg-primary/90",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"문서 업로드"]}),e.jsxs(i,{variant:"outline",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"템플릿 사용"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"전체 문서"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.totalDocuments})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-6 h-6 text-primary"})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx(L,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-500 text-sm font-medium",children:"+12%"}),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:"지난 달 대비"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"서명 완료"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.completedSignatures})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"w-6 h-6 text-green-500"})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx(L,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-500 text-sm font-medium",children:"+8%"}),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:"지난 달 대비"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"서명 대기"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.pendingSignatures})]}),e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-yellow-500"})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx("span",{className:"text-yellow-500 text-sm font-medium",children:"2건 급함"}),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:"오늘 마감"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"블록체인 검증"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.blockchainVerified})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-purple-500"})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx("span",{className:"text-green-500 text-sm font-medium",children:"Xphere 네트워크"}),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:"보안 검증됨"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"최근 문서"}),e.jsx(i,{variant:"ghost",className:"text-primary text-sm",children:"전체 보기"})]}),e.jsxs("div",{className:"space-y-4",children:[x.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 border border-gray-100 rounded-lg hover:border-gray-200 transition-colors cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:k(s.fileType)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500",children:s.status})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[C(s.status),s.status!=="서명 완료"&&e.jsxs(i,{size:"sm",variant:"outline",onClick:l=>{l.stopPropagation(),y(s)},className:"h-6 text-xs",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"서명 요청"]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.createdAt?new Date(s.createdAt).toLocaleDateString("ko-KR"):""})]})]},s.id)),x.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"아직 업로드된 문서가 없습니다."}),e.jsx(i,{variant:"ghost",className:"mt-2 text-primary",onClick:()=>o(!0),children:"첫 번째 문서 업로드하기"})]})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"서명 요청"}),e.jsx(i,{variant:"ghost",className:"text-primary text-sm",children:"전체 보기"})]}),e.jsxs("div",{className:"space-y-4",children:[c.slice(0,3).map(s=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"서명 요청"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["수신자: ",s.signerEmail]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx(v,{className:"w-3 h-3 inline mr-1"}),s.deadline?new Date(s.deadline).toLocaleDateString("ko-KR"):"마감일 없음"]})]}),e.jsx(i,{size:"sm",variant:"outline",children:"상세보기"})]})},s.id)),c.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"진행 중인 서명 요청이 없습니다."})]})]})]})})]}),e.jsxs("div",{className:"mt-8 bg-gradient-to-r from-purple-500 to-primary p-6 rounded-xl text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Xphere 블록체인 상태"}),e.jsx("p",{className:"text-purple-100 text-sm mt-2",children:"모든 서명이 블록체인에 안전하게 기록되고 있습니다"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm",children:"네트워크 연결됨"})]}),e.jsxs("p",{className:"text-sm text-purple-100",children:["블록 높이: ",e.jsx("span",{children:N.blockHeight})]}),e.jsxs("p",{className:"text-sm text-purple-100",children:["가스비: ",e.jsx("span",{children:N.gasFee})]})]})]}),e.jsxs("div",{className:"mt-6 bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"최근 블록체인 활동"}),e.jsx(ye,{hashInfo:{transactionHash:ve(),blockNumber:we(),network:"xphere",timestamp:new Date().toISOString(),confirmations:3,status:"confirmed",gasUsed:"35000",gasFee:"0.002",type:"signature"},title:"최근 전자서명 기록",compact:!0})]})]})]}),e.jsx(J,{open:w,onOpenChange:o}),f&&e.jsx(ke,{document:f,open:d,onOpenChange:u})]})}export{ts as default};
