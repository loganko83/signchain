# Progress Log - 2025-07-28

## 작업 시작
- 시간: 2025-07-28 
- 목적: 프로젝트 상태 확인 및 서버 배포 준비

## 현재 프로젝트 상태

### 1. 개발 환경
- ✅ Git 저장소 초기화 완료
- ✅ GitHub 원격 저장소 연결 완료 (https://github.com/loganko83/signchain)
- ✅ 로컬 main 브랜치와 origin/main 동기화 완료
- ✅ 프론트엔드: http://localhost:5175/ (Vite)
- ✅ 백엔드 API: http://localhost:5000/ (Express)
- ✅ SendGrid API 설정 완료

### 2. 보안 문제 해결 상태 (2025-01-28 완료)
- ✅ bcrypt 해싱 적용
- ✅ 하드코딩된 사용자 ID 제거
- ✅ 암호화 키 환경변수화
- ✅ WebAuthn 설정 환경변수화
- ✅ DID 개인키 암호화 저장
- ✅ SendGrid 이메일 환경변수화

### 3. 현재 파일 상태
- .env.backup 파일이 untracked 상태로 존재
- 이외 모든 변경사항은 커밋 완료

## 오늘 작업 계획

### 1. 프로젝트 정리
- [ ] .env.backup 파일 처리 (.gitignore에 추가)
- [ ] 최신 변경사항 확인 및 커밋
- [ ] GitHub 저장소와 동기화

### 2. 서버 배포 준비
- [ ] 서버 환경 확인 (trendy.storydot.kr/signchain)
- [ ] 필요한 환경변수 설정
- [ ] 배포 스크립트 작성

### 3. 데이터베이스 설정
- [ ] PostgreSQL/Neon 설정 확인
- [ ] 데이터베이스 스키마 적용

## 진행 사항

### 1. Git 상태 확인 ✅
- Git 저장소가 이미 초기화되어 있음
- origin/main과 동기화된 상태
- .env.backup 파일만 untracked 상태

### 2. 프로젝트 정리 ✅
- .env.backup을 .gitignore에 추가 완료
- 진행 상황 문서 생성 및 커밋 완료
- GitHub에 성공적으로 푸시 완료

### 3. 서버 상태 확인 ✅
- 서버 접속 확인 완료 (SSH-MCP)
- /var/www/html/signchain 디렉토리에 프로젝트가 이미 배포되어 있음
- git pull 성공 - 최신 상태
- PM2로 signchain 프로세스 실행 중이나 재시작 반복 중 (463회)
- .env 파일이 예제 상태 - 실제 환경변수 설정 필요
- Apache 웹서버 사용 중 - signchain 설정 추가 필요

### 4. 서버 설정 작업 ✅
- [x] PM2 ecosystem 설정 파일 생성 (ecosystem.config.cjs)
- [x] 로그 디렉토리 생성
- [x] PM2 프로세스 재시작 (cluster 모드로 실행 중)
- [x] Apache VirtualHost 설정 추가 (ProxyPass for /signchain)
- [x] 환경변수 설정 완료
- [x] PostgreSQL 설치 및 데이터베이스 생성
- [x] 데이터베이스 마이그레이션 실행 (drizzle-kit push)
- [x] PM2 자동 시작 설정

### 5. 완료된 배포 작업
- PostgreSQL 데이터베이스 설정 (signchain DB 생성)
- 포트 5001로 변경 (5000은 xpswap이 사용 중)
- Apache ProxyPass 설정으로 /signchain 경로 연결
- PM2로 안정적인 프로세스 관리
- 서버 재시작 시 자동 실행 설정

## 서버 배포 결과
- ✅ 서버 URL: https://trendy.storydot.kr/signchain
- ✅ API 서버: http://localhost:5001
- ✅ PostgreSQL DB: signchain@localhost:5432
- ✅ PM2 프로세스: 안정적으로 실행 중 (재시작 없음)
- ✅ Apache 리버스 프록시 설정 완료

## 추가 수정 사항
- ✅ Vite 설정에 base URL 추가 (BASE_URL=/signchain/)
- ✅ package.json 빌드 스크립트에 BASE_URL 환경변수 추가
- ✅ 서버에서 재빌드 및 배포 완료
- ✅ HTML 자산 경로가 /signchain/으로 올바르게 설정됨

## 최종 배포 상태
- **서비스 URL**: https://trendy.storydot.kr/signchain/
- **정상 작동 확인**: HTML에서 /signchain/assets/ 경로로 자산 로드
- **Apache ProxyPass**: /signchain → localhost:5001
- **PM2 프로세스**: 안정적으로 실행 중

## 문제 해결 과정
### 문제: /signchain 접속 시 워드프레스 페이지가 표시됨
- 원인: Vite 빌드 시 base URL이 설정되지 않아 자산 경로가 루트(/)로 설정됨
- 해결 방법:
  1. vite.config.ts에 `base: process.env.BASE_URL || '/'` 추가
  2. package.json 빌드 스크립트에 `BASE_URL=/signchain/` 환경변수 추가
  3. 서버에서 재빌드 후 배포

### 완료 시간: 2025-07-28 16:40 KST

## 추가 문제 발생 및 해결 시도
### 문제: /signchain 경로가 워드프레스 카테고리로 인식됨
- 시간: 2025-07-28 16:48 KST
- 증상: https://trendy.storydot.kr/signchain 접속 시 워드프레스 뉴스 페이지 표시
- 원인: 워드프레스가 모든 요청을 가로채서 /signchain을 카테고리로 처리
- Node.js 서버는 정상 작동 중 (localhost:5001에서 확인)

### 시도한 해결 방법들
1. Apache ProxyPass 설정 (실패)
2. RewriteRule 추가 (실패)
3. Alias 디렉토리 설정 (실패)
4. .htaccess 수정 시도 (실패)

### 문제 분석
- 워드프레스가 DocumentRoot에서 모든 요청을 처리
- Apache의 ProxyPass가 워드프레스의 .htaccess보다 늦게 처리됨
- 워드프레스의 강력한 리라이트 규칙이 우선순위를 가짐

### 대안 검토 중
1. 서브도메인 사용 (예: signchain.trendy.storydot.kr)
2. 다른 포트 사용 (예: trendy.storydot.kr:5001)
3. 워드프레스 외부 디렉토리 설정
4. Nginx 리버스 프록시 추가 검토

